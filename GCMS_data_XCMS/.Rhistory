a[i,]<- abs(temp)
View(a)
a<-liver_t2[FALSE,]
b<-liver_t2[FALSE,]
i = 1
j = 1
temp<-liver_t1[i,] - liver_t2[j,]
a[i,]<- abs(temp)
b[i,]<-b[i,] + a[i,]
View(a)
View(b)
a[is.na(a)] <- 0
b[is.na(b)] <- 0
temp<-liver_t1[i,] - liver_t2[j,]
a[i,]<- abs(temp)
b[i,]<-b[i,] + a[i,]
View(b)
View(a)
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
a[i,]<- abs(temp)
b[i,]<-b[i,] + a[i,]
}}
View(b)
i = 2
j = 3
temp<-liver_t1[i,] - liver_t2[j,]
View(temp)
a[i,]<- abs(temp)
View(a)
## control minus treatment 2
a<-liver_t2[FALSE,]
b<-liver_t2[FALSE,]
a[is.na(a)] <- 0
b[is.na(b)] <- 0
temp<-liver_t1[i,] - liver_t2[j,]
View(temp)
a[i,]<- abs(temp)
View(a)
b[i,]<-b[i,] + a[i,]
View(b)
a<-liver_t2[FALSE,]
b<-liver_t2[FALSE,]
a[is.na(a)] <- 0
b[is.na(b)] <- 0
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
#a[i,]<- abs(temp)
b[i,]<-b[i,] + abs(temp)
}}
View(b)
View(temp)
abs(temp)
i
b[10,]
View(b[10,])
a<-NULL
b[is.na(b)] <- 0
b<-liver_t2[FALSE,]
b[is.na(b)] <- 0
i = 1
j = 1
temp<-liver_t1[i,] - liver_t2[j,]
View(temp)
a<- abs(temp)
View(a)
b[i,]<-b[i,] + a
View9b
View(b)
i
j
class(a)
b[i,]<-b[i,] + a[i,]
View(b)
View(a)
b[i,] + a[i,]
View(b[i,] + a[i,])
View(b[i,])
b[is.na(b)] <- 0
b[i,]<-b[i,] + a[i,]
View(b)
j = 2
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
b[i,]<-b[i,] + a[i,]
View(b)
j = 3
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
b[i,]<-b[i,] + a[i,]
View(b)
i = 2
j = 1
temp<-liver_t1[i,] - liver_t2[j,]
View(temp)
a<- abs(temp)
View(a)
b[i,]<-b[i,] + a[i,]
View(b)
b[2,]
View(b[2,])
View(a[1,])
a[is.na(a)] <- 0
b[is.na(b)] <- 0
View(a)
View(b)
dim(liver_t2)
null.array <- array(data=NA, dim=c(10,1584,10))
View(null.array)
dim(null.array)
i = 1
j = 1
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
null.array[i,,j]<-a
View(null.array)
null.array[i,,j]<-as.matrix(a)
null.array[i,,j]<-as.vector(a)
null.array[j,,i]<-as.vector(a)
dim(a)
null.array[j,,i]<-a
dim(a)
dim(null.array)
null.array <- array(data=NA, dim=c(10,1584,10))
dim(null.array)
null.array[j,,i]<-a
View(null.array)
i
print(null.array[1,,1])
null.array <- array(data=NA, dim=c(10,1584,10))
print(null.array[1,,1])
i
j
j = 3
j
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
dim(a)
null.array[j,,i]<-a
View(null.array[3,,1])
i = 1
j = 1
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
null.array[i,,j]<-a
dim(a)
null.array[i,,]<-a
class(a)
null.array[i,,]<-as.matrix(a)
null.array[i,,j]<-as.matrix(a)
a
dim(a)
null.array <- array(data=NA, dim=c(10,1584,10))
null.array[i,,j]<-as.matrix(a)
null.array[1,,1]
i = 1
j = 3
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
null.array[i,,j]<-as.matrix(a)
null.array[1,,3]
null.array <- array(data=NA, dim=c(10,1584,10))
for (i in 1:4){
for (j in 1:4){
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
null.array[i,,j]<-as.matrix(a)
}}
View(null.array)
View[null.array[1,,4]]
View[null.array[1,,4])
View(null.array[1,,4])
dim(null.array)
View(null.array[,,4])
View(null.array[1,,1])
View(null.array[1,,2])
View(null.array[,,2])
View(null.array[,,3])
null.array <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
null.array[i,,j]<-as.matrix(a)
}}
View(null.array[,,8])
# add up 1st and 3rd dimensions
sum_out1<-apply(null.array, MARGIN=c(1, 3), sum)
View(sum_out1)
?aapply
?apply
# add up 1st and 3rd dimensions
sum_out1<-apply(null.array, MARGIN=c(1, 2), sum)
View(sum_out1)
# add up 1st and 3rd dimensions
sum_out1<-apply(null.array, MARGIN=c( 2), sum)
View(sum_out1)
# add up 1st and 3rd dimensions
sum_out1<-apply(null.array, MARGIN=c(1), sum)
View(sum_out1)
# add up 1st and 3rd dimensions
sum_out1<-apply(null.array, MARGIN=c(2,3), sum)
View(sum_out1)
# add up 1st and 3rd dimensions
sum_out1<-apply(null.array, MARGIN=c(1,2), sum)
View(sum_out1)
z <- array(1:10, dim = 1:3)
View(z)
dim(z)
z <- array(1:20, dim = c(3,4,5))
dim(z)
View(z)
apply(z, MARGIN = c(1,2), sum)
apply(z, MARGIN = c(1), sum)
apply(z, MARGIN = c(2), sum)
apply(z, MARGIN = c(3), sum)
View(z[,,1])
View(z[,,2])
View(z[,,3])
View(z[,,4])
View(z[,,5])
apply(z, MARGIN=c(2), sum)
# add up 1st and 3rd dimensions
sum_out1<-apply(null.array, MARGIN=c(2), sum)
View(sum_out1)
hist(sum_out1$V1)
hist(V1)
class(sum_out1)
array1 <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
array1[i,,j]<-as.matrix(a)
}}
#z <- array(1:20, dim = c(3,4,5))
#dim(z)
#apply(z, MARGIN = c(3), sum)
# add up 1st and 3rd dimensions
sum_out1<-apply(array1, MARGIN=c(2), sum)
## control minus treatment 3
array2 <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
array2[i,,j]<-as.matrix(a)
}}
# add up 1st and 3rd dimensions
sum_out2<-apply(array2, MARGIN=c(2), sum)
## control minus treatment 4
array3 <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
array3[i,,j]<-as.matrix(a)
}}
# add up 1st and 3rd dimensions
sum_out3<-apply(array3, MARGIN=c(2), sum)
cbind.data.frame(sum_out1, sum_out2, sum_out3)
sum_out_all<-cbind.data.frame(sum_out1, sum_out2, sum_out3)
names(array2 <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
array2[i,,j]<-as.matrix(a)
}}
# add up 1st and 3rd dimensions
sum_out2<-apply(array2, MARGIN=c(2), sum))
names(sum_out_all)
hist(sum_out_all$sum_out1)
hist(sum_out_all$sum_out2)
hist(sum_out_all$sum_out3)
array1 <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
array1[i,,j]<-as.matrix(a)
}}
#z <- array(1:20, dim = c(3,4,5))
#dim(z)
#apply(z, MARGIN = c(3), sum)
# add up 1st and 3rd dimensions
sum_out1<-apply(array1, MARGIN=c(2), sum)
## control minus treatment 3
array2 <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t2)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
array2[i,,j]<-as.matrix(a)
}}
# add up 1st and 3rd dimensions
sum_out2<-apply(array2, MARGIN=c(2), sum)
## control minus treatment 4
array3 <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t3)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
array3[i,,j]<-as.matrix(a)
}}
# add up 1st and 3rd dimensions
sum_out3<-apply(array3, MARGIN=c(2), sum)
sum_out_all<-cbind.data.frame(sum_out1, sum_out2, sum_out3)
par(mfrow=c(3,1))
par(mar = c(4, 4, 1, 4))
hist(sum_out_all$sum_out1, col="red")
hist(sum_out_all$sum_out2, col="blue")
hist(sum_out_all$sum_out3, col="purple")
summary(sum_out_all)
array1 <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t2)){
temp<-liver_t1[i,] - liver_t2[j,]
a<- abs(temp)
array1[i,,j]<-as.matrix(a)
}}
#z <- array(1:20, dim = c(3,4,5))
#dim(z)
#apply(z, MARGIN = c(3), sum)
# add up 1st and 3rd dimensions
sum_out1<-apply(array1, MARGIN=c(2), sum)
## control minus treatment 3
array2 <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t3)){
temp<-liver_t1[i,] - liver_t3[j,]
a<- abs(temp)
array2[i,,j]<-as.matrix(a)
}}
# add up 1st and 3rd dimensions
sum_out2<-apply(array2, MARGIN=c(2), sum)
## control minus treatment 4
array3 <- array(data=NA, dim=c(10,1584,10))
for (i in 1:nrow(liver_t1)){
for (j in 1:nrow(liver_t4)){
temp<-liver_t1[i,] - liver_t4[j,]
a<- abs(temp)
array3[i,,j]<-as.matrix(a)
}}
# add up 1st and 3rd dimensions
sum_out3<-apply(array3, MARGIN=c(2), sum)
# combine treatment comparison sums
sum_out_all<-cbind.data.frame(sum_out1, sum_out2, sum_out3)
# plot histograms of total sums for each trtmt comparison
par(mfrow=c(3,1))
par(mar = c(4, 4, 1, 4))
hist(sum_out_all$sum_out1, xlab="Sum Difference (Control - Pesticide)", main="",col="red")
hist(sum_out_all$sum_out2, xlab="Sum Difference (Control - Bullfrog)", main="",col="blue")
hist(sum_out_all$sum_out3, xlab="Sum Difference (Control - Pesticide & Bullfrog)", main="", col="purple")
hist(sum_out_all$sum_out1, xlab="Sum Difference (Control - Pesticide)", main="",col="red", xlim=c(0,150))
# plot histograms of total sums for each trtmt comparison
par(mfrow=c(3,1))
par(mar = c(4, 4, 1, 4))
hist(sum_out_all$sum_out1, xlab="Sum Difference (Control - Pesticide)", main="",col="red", xlim=c(0,150))
hist(sum_out_all$sum_out2, xlab="Sum Difference (Control - Bullfrog)", main="",col="blue", xlim=c(0,150))
hist(sum_out_all$sum_out3, xlab="Sum Difference (Control - Pesticide & Bullfrog)", main="", col="purple", xlim=c(0,150))
# subset based on threshold for each trtmt control comparison
# create column for peak no
peak_no<-seq(1,1584, 1)
sumout1_no<-cbind(sum_out1, peak_no)
sumout1_no
names(sumout1_no)
head(sumout1_no)
sumout1_f<-filter(sumout1_no, sum_out1 > threshold)
class(sumout1_no)
sumout1_no<-cbind.data.frame(sum_out1, peak_no)
# drop peaks
threshold<-100
sumout1_f<-filter(sumout1_no, sum_out1 > threshold)
# check to see ~20% dropped
dim(sumout1_f)[1] / dim(sumout1_no)[1]
# drop peaks
threshold<-105
sumout1_f<-filter(sumout1_no, sum_out1 > threshold)
# check to see ~20% dropped
dim(sumout1_f)[1] / dim(sumout1_no)[1]
# drop peaks
threshold<-110
sumout1_f<-filter(sumout1_no, sum_out1 > threshold)
# check to see ~20% dropped
dim(sumout1_f)[1] / dim(sumout1_no)[1]
# drop peaks
threshold<-112
sumout1_f<-filter(sumout1_no, sum_out1 > threshold)
# check to see ~20% dropped
dim(sumout1_f)[1] / dim(sumout1_no)[1]
# drop peaks
threshold<-113
sumout1_f<-filter(sumout1_no, sum_out1 > threshold)
# check to see ~20% dropped
dim(sumout1_f)[1] / dim(sumout1_no)[1]
## control vs frog
# create column for peak no
peak_no<-seq(1,1584, 1)
sumout2_no<-cbind.data.frame(sum_out2, peak_no)
# drop peaks
threshold<-75
sumout2_f<-filter(sumout2_no, sum_out2 > threshold)
# check to see ~20% dropped
dim(sumout2_f)[1] / dim(sumout2_no)[1]
# drop peaks
threshold<-85
sumout2_f<-filter(sumout2_no, sum_out2 > threshold)
# check to see ~20% dropped
dim(sumout2_f)[1] / dim(sumout2_no)[1]
# drop peaks
threshold<-82
sumout2_f<-filter(sumout2_no, sum_out2 > threshold)
# check to see ~20% dropped
dim(sumout2_f)[1] / dim(sumout2_no)[1]
# drop peaks
threshold<-81
sumout2_f<-filter(sumout2_no, sum_out2 > threshold)
# check to see ~20% dropped
dim(sumout2_f)[1] / dim(sumout2_no)[1]
# drop peaks
threshold<-82
sumout2_f<-filter(sumout2_no, sum_out2 > threshold)
# check to see ~20% dropped
dim(sumout2_f)[1] / dim(sumout2_no)[1]
peak_no<-seq(1,1584, 1)
sumout3_no<-cbind.data.frame(sum_out3, peak_no)
# drop peaks
threshold<-113
sumout3_f<-filter(sumout3_no, sum_out3 > threshold)
# check to see ~20% dropped
dim(sumout3_f)[1] / dim(sumout3_no)[1]
# drop peaks
threshold<-82
sumout3_f<-filter(sumout3_no, sum_out3 > threshold)
# check to see ~20% dropped
dim(sumout3_f)[1] / dim(sumout3_no)[1]
# drop peaks
threshold<-75
sumout3_f<-filter(sumout3_no, sum_out3 > threshold)
# check to see ~20% dropped
dim(sumout3_f)[1] / dim(sumout3_no)[1]
# drop peaks
threshold<-76
sumout3_f<-filter(sumout3_no, sum_out3 > threshold)
# check to see ~20% dropped
dim(sumout3_f)[1] / dim(sumout3_no)[1]
head(sumout1_f)
# pest #
pest.m2<-merge(sumout1_f, rfe_pest2, by.x="peak_no", by.y="peak_no")
rfe_pest<-read.csv(paste0(datadir, "output/RFE_ctrlvspest.csv"))
rfe_frog<-read.csv(paste0(datadir,"output/RFE_ctrlvbullfrog.csv"))
rfe_combined<-read.csv(paste0(datadir,"output/RFE_ctrlvpest_and_bullfrog_allbins.csv"))
#### import ranked and identified list for each treatment ####
rfeid_pest<-read.csv(paste0(datadir, "output/pest_metabolite_id_all_treatments_combined_wmh_final_110119.csv"))
rfeid_combined<-read.csv(paste0(datadir,"output/combined_metabolite_id_all_treatments_combined_wmh_final_110119.csv"))
rfeid_frog<-read.csv(paste0(datadir,"output/bullfrog_metabolite_id_all_treatments_combined_wmh_final_110119.csv"))
########################################
#### format SVM-RFE ranked peaks ####
## PEST
# drop first 2 rows
rfe_pest<-rfe_pest[-1:-2,]
# drop all columns except the peak time and the rank
rfe_pest<-rfe_pest[,1:2]
# add peak_no column for join
peak_no<-seq(1,1585, 1)
rfe_pest2<-cbind(rfe_pest, peak_no)
## FROG
# drop first 2 rows
rfe_frog<-rfe_frog[-1:-2,]
# drop all columns except the peak time and the rank
rfe_frog<-rfe_frog[,1:2]
# add peak_no column for join
peak_no<-seq(1,1585, 1)
rfe_frog2<-cbind(rfe_frog, peak_no)
## COMBINED
# drop first 2 rows
rfe_combined<-rfe_combined[-1:-2,]
# drop all columns except the peak time and the rank
rfe_combined<-rfe_combined[,1:2]
# add peak_no column for join
peak_no<-seq(1,1585, 1)
rfe_combined2<-cbind(rfe_combined, peak_no)
# pest #
pest.m2<-merge(sumout1_f, rfe_pest2, by.x="peak_no", by.y="peak_no")
View(pest.m2)
pest.f2<-filter(pest.m2, featureRankedList4join2 < 100)
dim(pest.f2) # 73 of 100 ranked peaks remaining
# frog #
frog.m2<-merge(sumout1_f, rfe_frog2, by.x="peak_no", by.y="peak_no")
frog.f2<-filter(frog.m2, featureRankedList4join2 < 100)
dim(frog.f2) # 74 of 100 ranked peaks remaining
# combined #
combined.m2<-merge(sumout1_f, rfe_combined2, by.x="peak_no", by.y="peak_no")
combined.f2<-filter(combined.m2, featureRankedList4join2 < 100)
dim(combined.f2) # 75 of 100 ranked peaks remaining
#### merge with identified peak list from Matthew ####
# pest #
rfeid_pest_sub2<-merge(rfeid_pest, pest.f2,by.x="RT",by.y="X")
View(rfeid_pest_sub2)
# frog #
rfeid_frog_sub2<-merge(rfeid_frog, frog.f2,by.x="RT",by.y="X")
View(rfeid_frog_sub2)
# combined #
rfeid_combined_sub2<-merge(rfeid_combined, combined.f2,by.x="RT",by.y="X")
View(rfeid_combined_sub2)
# write out combined CSV
write.csv(rfeid_pest_sub2, paste0(datadir, "output/rfeid_pest_sub2.csv"))
write.csv(rfeid_frog_sub2, paste0(datadir, "output/rfeid_frog_sub2.csv"))
write.csv(rfeid_combined_sub2, paste0(datadir, "output/rfeid_combined_sub2.csv"))
