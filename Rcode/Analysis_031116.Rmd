---
title: "Analysis of liver un-targeted metabolomic data"
author: "mns"
date: "March 11, 2016"
output: pdf_document
---
Data is from a multiple stressors experiment where leopard frogs in water were exposed to either carbaryl, bullfrog stressor, or carbaryl & bullfrog stress. Controls were exposed to the carbaryl carrier only. After a 24 hour acclimation and a 48 hour exposure livers were extracted for metabolomics analysis. Data is in CDF form in Dropbox - \Dropbox\amphib_metabolomics\PIP\data\mns_pip_031116\ and
\Dropbox\amphib_metabolomics\PIP\XCMS_031116_centwave

Libraries used:
```{r}
library(e1071)
library(muma)
```
Data from the GC-MS (autospec) was retention time aligned in xcms online and exported. The exported file had 2665 identified features. Some retention times had more than one m/z value so I sorted the data by median retention time and deleted duplicates based on abunance at a retention time. Here I import that data. 
```{r}
XCMS.diffreport4R <- read.csv("~/git/PIP/GCMS_data_XCMS/XCMS.diffreport4R.csv")
View(XCMS.diffreport4R)
liver1<-XCMS.diffreport4R
```

Here I format the data to look for outliers with a PCA using library(MUMA)
```{r, echo=FALSE}
n<-liver1$rtmed
liver1_t<-as.data.frame(t(liver1[,-1]))
colnames(liver1_t)<-n
View(liver1_t)
liver1_t$Samples <- factor(colnames(liver1)[-1])
# [1] mns13pip3p_again  mns1pip3p      mns20pip2p2      mns20pip4p #     
# [5] mns22pip2p       mns24pip4p       mns26pip1p       mns27pip1p #     
# [9] mns28pip1p2      mns2pip1p2       mns31pip3p2      mns32pip3p #     
#[13] mns34pip3p       mns4pip1p        mns9pip4p        mnsC50pip2p #    
#[17] mnsC51pip4p2     mnsC52pip2p2     mnsC53pip2p2     mnsJ1pip4p #      
#[21] mns12pip4p       mns15pip2p       mns15pip4p2      mns18pip2p  #    
#[25] mns23pip2p       mns23pip4p       mns24pip2p       mns25pip3p #     
#[29] mns26pip3p2      mns30pip1p       mns30pip3p2      mns32pip1p #     
#[33] mns34pip1p       mns35pip1p2      mns3pip3p        mns41pip4p #     
#[37] mns4pip3p2       mns6pip1p        mns9pip2p        mnsC52pip4p       
liver1_t$Class<-c("3","3","1","1","1","1","3","3","3","3","3","3","3","3","1","1","1","1","1","1","2","2","2","2","2","2","2","4","4","4","4","4","4",
                 "4","4","2","4","4","2","2")
head(summary(liver1_t))
liver1_t<-liver1_t[sapply(liver1_t, function(liver1_t)!any(is.na(liver1_t)))]#get rid of columns with NA
data[,c(ncol(data),1:(ncol(data)-1))]
View(liver1_t)
data <- data[,c(1:6,18,7:17)] 
liver2_t<-liver1_t[,c(1587, 2:1586)]
View(liver2_t)
setwd("~/git/PIP/GCMS_data_XCMS")
write.csv(liver2_t, file="liver2_t_out.csv")
```

MUMA for outlier analysis w 4 treatment groups
```{r}
setwd("~/git/PIP/GCMS_data_XCMS")
work.dir(dir.name="WorkDir_liver1")
# delete first row in excel of .csv 

explore.data(file="liver2_t_out.csv", scaling="a", scal=TRUE, normalize=TRUE, imputation=FALSE, imput="ImputType")
par( mfrow = c( 1, 2 ) )
Plot.pca(pcx=1, pcy=2, scaling="a", test.outlier=TRUE)
explore.data(file="liver2_t_out.csv", scaling="p", scal=TRUE, normalize=TRUE, imputation=FALSE, imput="ImputType")
```
No obvious outliers were present.

PLS-DA plots with all data at two different scaling - pareto and auto scaling.
```{r}
plsda(scaling="a") 
Plot.plsda(pcx=1, pcy=2, scaling="a")
Plot.plsda(pcx=2, pcy=3, scaling="a")

plsda(scaling="p") 
Plot.plsda(pcx=1, pcy=2, scaling="a")
Plot.plsda(pcx=2, pcy=3, scaling="a")
```
Black- control
Red - pesticide only
Green - bullfrog only
Blue - pesticide + bullfrog

The PLS-DA distinguishes the pesticide only treatment from the other treatments in component 1 (29.2%) the most readily w either pareto or autoscaling options. The other treatments were mostly overlapping in pls-da space so I decided to eliminate the fourth treatment (pesticide + bullfrog) to see if the pls-da can better distinguish individual effects.

```{r}
#set up directory structure for MUMA pca and plsda
setwd("~/git/PIP/GCMS_data_XCMS")
work.dir(dir.name="WorkDir_liver2")
#pca
explore.data(file="liver3_t_out.csv", scaling="a", scal=TRUE, normalize=TRUE, imputation=FALSE, imput="ImputType")
par( mfrow = c( 1, 2 ) )
Plot.pca(pcx=1, pcy=2, scaling="p", test.outlier=TRUE)
explore.data(file="liver3_t_out.csv", scaling="p", scal=TRUE, normalize=TRUE, imputation=FALSE, imput="ImputType")
#plsda
plsda(scaling="p") 
Plot.plsda(pcx=1, pcy=2, scaling="p")
plsda(scaling="a") 
Plot.plsda(pcx=1, pcy=2, scaling="a")

```




